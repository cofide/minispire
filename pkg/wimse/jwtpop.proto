syntax = "proto3";

option go_package = "github.com/cofide/cofide-sdk-go/wimse/pb";


service SpireJWTPOPExtension {
    rpc FetchJWTPOP(JWTPOPRequest) returns (JWTPOPResponse);
}


message JWTPOPRequest {
    // Required. Serialised JWK
    string key = 1;
    // Optional. The requested SPIFFE ID for the JWT-SVID. If unset, all
    // JWT-SVIDs to which the workload is entitled are requested.
    string spiffe_id = 2;
    // Required. The JWT-SVID audience.
    string audience = 3;
}

message JWTPOPResponse {
    string spiffe_id = 1;
    repeated JWTPOPSVID svids = 2;
}

// The JWTPOPSVID message carries the JWT-SVID token and associated metadata.
message JWTPOPSVID {
    // Required. The SPIFFE ID of the JWT-SVID.
    string spiffe_id = 1;

    // Required. Encoded JWT using JWS Compact Serialization.
    string svid = 2;

    // Optional. An operator-specified string used to provide guidance on how this
    // identity should be used by a workload when more than one SVID is returned.
    // For example, `internal` and `external` to indicate an SVID for internal or
    // external use, respectively.
    string hint = 3;
}